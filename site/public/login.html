<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./css/style-login.css">
  <title>Login</title>
</head>
<body>

  <!-- menu -->
  <div class="header">
    <div class="container">
      <a href="./Tela Inicial.html">
        <img src="assets/Logo.png" alt="logo" class="logo1">
      </a>
        <h1 class="logo"></h1>
        <div class="nav-bar-left">
            <ul>
                <li><a class="a-nav-left" href="./index.html">Home</a></li>
                <li><a class="a-nav-left" href="./Tela plano de sensores.html">Planos de sensores</a></li>
                <li><a class="a-nav-left" href="./Tela Calculadora.html" target="_blank">Calculadora</a></li>
                <li><a class="a-nav-left" href="./Tela Contato.html">Contato</a></li>
                <li ><a  id="dashBoard" class="a-nav-left" href="./Tela Dashboard/Tela DashBoard.html">Dashboard</a></li>
                <li><a class="a-nav-left" href="./Tela Quantum.html">Equipe Quantum</a></li>
            </ul>
        </div>
        <div class="nav-bar-right">

            <img id="logo" src="assets/Logo.png" class="logo1">
        </div>
        <div class="barra_lateral">
            <i onclick="gerenciarMenu()" class="fa-solid fa-bars" style="color: #e8e1f1;"></i>
        </div>
    </div>
</div>

<main>
   <!-- login -->
   <div class="container-login">
    <div class="informacao-login">
      <img class="icon-perfil" src="assets/perfil.png">
      <h3 class="title-login">LOGIN</h3>

      <!-- NOME ou EMAIL -->
      <li class="title-da-input">E-mail <br> </li>
        <div class="icons">
          <img class="icon-email-input" src="assets/icons/o-email.png"> <input type="text" class="input" id="ipt_email" placeholder="Digite seu email">
        </div>
      
      <!-- SENHA -->
      <li class="title-da-input">Senha <br> </li>
      <div class="icons">
        <img class="icon-senha-input" src="assets/icons/cadeado-seguro.png"> <input type="password" class="input" id="ipt_senha" placeholder="Senha">
        <i id="btn-senha" onclick="mostrar_senha()" class="bi bi-eye"></i>
      </div>

      <div id="mensagem_erro" style="margin-top: 8px;"></div>
    
      <!-- ESQUECEU SENHA OU CRIAR CONTA -->
      <a class="senha-recuperar"> Não tem conta?</a>
      <a class="fazer-cadastro" href="../Tela de Cadastro/index.html"> Cadastrar-se</a>
      <br>
        <button onclick="entrar()" class="acessar-button-style" id="button-acessar">Acessar</button>
 
    </div>
    <div class="img-div"><img class="img-lateral" src="assets/img-lateral.jpg"></div>
</div>
</main>

<footer>
    <div id="footer_content">
        <div id="footer_contacts">
            <img src="assets/Logo.png" alt="logo" class="logo2">
            <p>É tudo sobre o seu sonho.</p>
            <div id="footer_social_media">
                <a href="#" class="footer-link" id="instagram">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a href="#" class="footer-link" id="facebook">
                    <i class="fa-brands fa-facebook"></i>
                </a>
                <a href="" class="footer-link" id="email">
                    <i class="fa-solid fa-envelope"></i>
                </a>
            </div>
            <div id="footer_subscribe">
              <p>
                  Entre com seu e-mail para receber noticías sobre nossas novas soluções
              </p>
              <div id="input_email">
                  <input type="text" name="" id="email_ipt">
                  <button class="button-ipt">
                      <i class="fa-solid fa-envelope"></i>
                  </button>
              </div>
          </div>
        </div>
        <div id="div-footer-list">
            <ul class="footer-list">
                <li>
                    <h3> Extensão de atuação </h3>
                </li>
                <li>
                    <img src="assets/mapa-do_brasil.png" alt="mapa_do_brasil" class="mapa-br">
                </li>
                <li class="footer_li">
                    <a href="./Tela Inicial.html" class="footer-link">Home</a>
                    <a href="./Tela Calculadora.html" class="footer-link">Calculadora</a>
                    <a href="./Tela plano de sensores.html" class="footer-link">Planos de sensores</a>
                </li>
            </ul>
        </div>

        <ul class="footer-list">
            <li>
                <h3>Time Quantum Sensors</h3>
            </li>
            <li>
                <a href="./Tela Contato.html" class="footer-link">Contato</a>
            </li>
            <li>
                <a href="./Tela Contato.html" class="footer-link">Trabalhe conosco</a>
            </li>
            <li>
                <a href="./Tela Quantum.html" class="footer-link">equipe Quantum Sensors</a>
            </li>

        </ul>
    </div>
    <div id="footer_copyright">
        &#169
        2023 all rights reserved by Quantum Sensors
    </div>
</footer>

</body>
</html>

<script>

  function mostrar_senha () {
    var inputPass = document.getElementById('ipt_senha')
    var btnShowPass = document.getElementById('btn-senha')

    if(inputPass.type === 'password') {
      inputPass.setAttribute('type', 'text')
      btnShowPass.classList.replace('bi-eye', 'bi-eye-slash')
    } else {
      inputPass.setAttribute('type', 'password')
      btnShowPass.classList.replace('bi-eye-slash', 'bi-eye')
    }
  }

  
  function entrar() {

var emailVar = ipt_email.value;
var senhaVar = ipt_senha.value;

if (emailVar == "" || senhaVar == "") {
    alert("(Mensagem de erro para todos os campos em branco)")
    return false;
} else {

console.log("FORM LOGIN: ", emailVar);
console.log("FORM SENHA: ", senhaVar);

fetch("/usuarios/autenticar", {
    method: "POST",
    headers: {
        "Content-Type": "application/json"
    },
    body: JSON.stringify({
        emailServer: emailVar,
        senhaServer: senhaVar
    })
}).then(function (resposta) {
    console.log("ESTOU NO THEN DO entrar()!")

    if (resposta.ok) {
        console.log(resposta);

        resposta.json().then(json => {

          

            console.log(json);
            console.log(JSON.stringify(json));
            sessionStorage.EMAIL_EMPRESA = json.email;
            sessionStorage.NOME_EMPRESA = json.nomeEmpresa;
            sessionStorage.ID_EMPRESA = json.idEmpresa;

            setTimeout(function () {
                window.location = "./Tela Dashboard/Tela Dashboard.html";
            }, 1000); // apenas para exibir o loading

        });

    } else {

        console.log("Houve um erro ao tentar realizar o login!");

        resposta.text().then(texto => {
            console.error(texto);
        });
    }

}).catch(function (erro) {
    console.log(erro);
})

return false;

}


}
    

var idEmpresa = sessionStorage.ID_EMPRESA
  validacao()

  

  function validacao() {
    var dashboard = document.getElementById("dashBoard")
    var logo = document.getElementById("logo")

  if (idEmpresa == undefined) {
    dashboard.classList.add('esconder')

    } else {

        fetch("/usuarios/validacao", {
            method: 'GET'
        }).then(function (resposta) {

            if (resposta.ok) {
                if (resposta.status == 204) {
                    console.log("nenhuma resposta encontrada")
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    dashboard.classList.remove('esconder')
              

                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);

        });
      }

    }
</script>


<script>
	window.fwSettings={
	'widget_id':154000000845
	};
	!function(){if("function"!=typeof window.FreshworksWidget){var n=function(){n.q.push(arguments)};n.q=[],window.FreshworksWidget=n}}() 
</script>
<script type='text/javascript' src='https://widget.freshworks.com/widgets/154000000845.js' async defer></script>

<!-- CODIGO PARA USAR NO CADASTRO;  title="Insira uma Senha que contenha ao menos 1 caracter Maiúsculo, Especial e Número" -->